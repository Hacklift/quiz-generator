services:
  - type: web
    name: fastapi-app
    env: python
    buildCommand: |
      cd server && \
      pip install --upgrade pip && \
      pip install pipenv && \
      pipenv install --system --deploy
    startCommand: uvicorn server.main:app --host 0.0.0.0 --port 10000
    envVars:
      - key: ALLOWED_ORIGINS
        sync: false
      - key: MONGO_URI
        sync: false
      - key: REDIS_URL
        sync: false
      - key: SENDER_EMAIL
        sync: false
      - key: SENDER_PASSWORD
        sync: false
      - key: EMAIL_HOST
        value: smtp.gmail.com
      - key: EMAIL_PORT
        value: "587"
      - key: SHARE_URL
        value: https://quiz-generator-2.vercel.app
    plan: free

  - type: worker
    name: celery-worker
    env: python
    buildCommand: |
      cd server && \
      pip install --upgrade pip && \
      pip install pipenv && \
      pipenv install --system --deploy
    startCommand: celery -A server.celery_config.celery_app worker --loglevel=info --concurrency=1
    envVars:
      - key: REDIS_URL
        sync: false
      - key: MONGO_URI
        sync: false
      - key: SENDER_EMAIL
        sync: false
      - key: SENDER_PASSWORD
        sync: false
      - key: EMAIL_HOST
        value: smtp.gmail.com
      - key: EMAIL_PORT
        value: "587"
      - key: ALLOWED_ORIGINS
        sync: false
      - key: SHARE_URL
        value: https://quiz-generator-2.vercel.app
    plan: free








# services:
#   - type: web
#     name: fastapi-app
#     env: python
#     buildCommand: |
#       cd server && \
#       pip install --upgrade pip && \
#       pip install pipenv && \
#       pipenv install --system --deploy
#     startCommand: uvicorn server.main:app --host 0.0.0.0 --port 10000
#     envVars:
#       - key: MONGO_URI
#         value: "mongodb+srv://admin:<password>@cluster0.xxxxx.mongodb.net/mydatabase?retryWrites=true&w=majority"
#     plan: free
